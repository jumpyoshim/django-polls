{% extends 'polls/base.html' %}

{% block content %}
<form method="post">
    <h2>Question</h2>
    <p class="question">「{{ question.text }}」</p>

    <h2>Choices</h2>
    {% for choice in choices %}
        <div class="choice">
            <span>「{{ choice.text }}」</span>
            <span class="votes" id="votes-{{ choice.pk }}">{{ choice.votes }}</span>

            {% csrf_token %}
            <button type="button" class="btn btn-outline-primary vote" id="{{ choice.pk }}">+1</button>
        </div>
    {% endfor %}
</form>
{% endblock %}

{% block extrajs %}
<script>
$(function(){
    $('.vote').on('click', function(){
        var pk = $(this).attr('id');
        console.log(pk)
        $.ajax({
            url: `/vote/${pk}/`,
            type: 'GET'
        })
        .done((data)=>{
            var votesElement = `#votes-${pk}`
            var votes = Number($(votesElement).text());
            votes += 1;
            $(votesElement).text(votes);
        })
        .fail((data)=>{
            console.log('fail')
        })
    });
});
</script>
{% endblock %}
